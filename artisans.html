<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nos Artisans | ProMaallem</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Montserrat:wght@600;700&family=Open+Sans:wght@400;500;600&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1A2B48',
                        accent: '#C62828',
                        'text-body': '#000000',
                        'bg-light': '#F7FAFC',
                    },
                    fontFamily: {
                        sans: ['Open Sans', 'sans-serif'],
                        title: ['Montserrat', 'sans-serif'],
                        cairo: ['Cairo', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="font-sans text-text-body bg-bg-light">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 bg-white/95 backdrop-blur-sm shadow-sm border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-2">
                <img src="logo-promaallem.png" alt="ProMaallem" class="h-10 md:h-12 w-auto object-contain">
            </a>
            <div class="hidden lg:flex items-center gap-8 font-medium text-sm">
                <a href="index.html" data-i18n="nav-home" class="hover:text-accent transition-colors">Accueil</a>
                <a href="services.html" data-i18n="nav-services"
                    class="hover:text-accent transition-colors">Services</a>
                <a href="artisans.html" data-i18n="nav-artisans" class="text-accent font-semibold transition-colors">Nos
                    Artisans</a>
                <a href="booking.html" data-i18n="nav-book"
                    class="bg-accent text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition-colors">Réserver</a>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="toggleLanguage()" id="lang-btn"
                    class="text-xs font-bold border border-gray-200 px-3 py-1 rounded hover:bg-gray-50 transition-all font-cairo">Français</button>
                <button class="lg:hidden text-primary" id="menu-btn">
                    <i data-lucide="menu" class="w-8 h-8"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu (Hidden) -->
        <div id="mobile-menu"
            class="hidden lg:hidden absolute top-20 left-0 w-full bg-white border-b border-gray-100 shadow-lg flex-col p-6 gap-4 z-40">
            <a href="index.html" data-i18n="nav-home" class="text-lg font-medium hover:text-accent">Accueil</a>
            <a href="services.html" data-i18n="nav-services" class="text-lg font-medium hover:text-accent">Services</a>
            <a href="artisans.html" data-i18n="nav-artisans" class="text-lg font-medium text-accent">Nos Artisans</a>
            <a href="booking.html" data-i18n="nav-book"
                class="bg-accent text-white px-4 py-2 rounded-lg text-center font-bold">Réserver</a>
        </div>
    </nav>

    <!-- Header -->
    <header class="bg-primary text-white pt-32 pb-20 px-6 text-center">
        <h1 class="text-4xl md:text-5xl font-bold font-title mb-6"><span data-i18n="nav-artisans">Nos Artisans</span>
        </h1>
        <p class="text-xl text-gray-200 max-w-2xl mx-auto font-light">Trouvez le meilleur artisan près de chez vous.</p>

        <!-- Search / Filter Component -->
        <div class="max-w-4xl mx-auto mt-10 bg-white p-4 rounded-2xl shadow-xl flex flex-col md:flex-row gap-4">
            <div class="flex-1 relative">
                <i data-lucide="map-pin" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                <select id="filter-city"
                    class="w-full pl-12 pr-4 py-3 bg-gray-50 rounded-xl text-gray-700 outline-none focus:ring-2 focus:ring-accent appearance-none cursor-pointer">
                    <option value="">Toutes les villes</option>
                    <option value="Casablanca">Casablanca</option>
                    <option value="Rabat">Rabat</option>
                    <option value="Marrakech">Marrakech</option>
                    <option value="Tanger">Tanger</option>
                    <option value="Fès">Fès</option>
                    <option value="Agadir">Agadir</option>
                </select>
            </div>
            <div class="flex-1 relative">
                <i data-lucide="wrench" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                <select id="filter-specialty"
                    class="w-full pl-12 pr-4 py-3 bg-gray-50 rounded-xl text-gray-700 outline-none focus:ring-2 focus:ring-accent appearance-none cursor-pointer">
                    <option value="">Toutes les spécialités</option>
                    <option value="Plomberie">Plomberie</option>
                    <option value="Électricité">Électricité</option>
                    <option value="Climatisation">Climatisation</option>
                    <option value="Serrurerie">Serrurerie</option>
                    <option value="Peinture">Peinture</option>
                    <option value="Bricolage">Bricolage</option>
                </select>
            </div>
            <button id="search-btn"
                class="bg-accent text-white px-8 py-3 rounded-xl font-bold hover:bg-opacity-90 transition-all flex items-center justify-center gap-2">
                <i data-lucide="search" class="w-5 h-5"></i>
                Rechercher
            </button>
        </div>
    </header>

    <!-- Artisans Grid -->
    <section class="max-w-7xl mx-auto px-6 py-16">
        <div id="artisans-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Cards injected by JS -->
        </div>

        <div id="no-results" class="hidden text-center py-12">
            <i data-lucide="user-x" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
            <h3 class="text-xl font-bold text-gray-500">Aucun artisan trouvé</h3>
            <p class="text-gray-400">Essayez de modifier vos filtres.</p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 pt-16 pb-8">
        <div class="max-w-7xl mx-auto px-6 flex flex-col items-center">
            <img src="logo-promaallem.png" alt="ProMaallem" class="h-10 md:h-12 w-auto object-contain mb-4">
            <p class="text-xs text-gray-500">© 2026 ProMaallem. Tous droits réservés.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/maallems_data.js"></script>
    <script src="js/i18n.js"></script>
    <script>
        lucide.createIcons();

        // DOM Elements
        const grid = document.getElementById('artisans-grid');
        const noResults = document.getElementById('no-results');
        const cityFilter = document.getElementById('filter-city');
        const specialtyFilter = document.getElementById('filter-specialty');
        const searchBtn = document.getElementById('search-btn');

        // Render Function
        function renderMaallems(city = '', specialty = '') {
            grid.innerHTML = '';

            const filtered = maallems.filter(m => {
                const matchCity = city === '' || m.city === city;
                const matchSpecialty = specialty === '' || m.trade.toLowerCase() === specialty.toLowerCase();
                return matchCity && matchSpecialty;
            });

            if (filtered.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');

                filtered.forEach(m => {
                    const el = document.createElement('div');
                    el.className = 'bg-white rounded-2xl p-6 shadow-soft hover:shadow-hover transition-all border border-gray-100 flex flex-col items-center text-center group';

                    // Status Badge Logic
                    const isAvail = m.is_available_now;
                    const statusClass = isAvail ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700';
                    const statusKey = isAvail ? 'status-available' : 'status-busy';
                    const statusText = window.t ? window.t(statusKey) : (isAvail ? 'DISPONIBLE' : 'EN INTERVENTION');
                    const statusIcon = isAvail ? 'check-circle-2' : 'clock';

                    // Name & Trade Localization
                    const lang = window.currentLang ? window.currentLang() : 'fr';
                    const displayName = (lang === 'ar' && m.name_ar) ? m.name_ar : m.name;

                    // Capitalize trade for display (or we could translate it if we had keys)
                    const displayTrade = m.trade.charAt(0).toUpperCase() + m.trade.slice(1);

                    el.innerHTML = `
                        <div class="relative mb-4">
                            <a href="artisan-profile.html?id=${m.id}" class="block">
                                <img src="${m.photo_url}" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-md group-hover:scale-105 transition-transform mx-auto">
                            </a>
                            ${m.is_certified ? `
                            <div class="absolute bottom-0 right-1/2 translate-x-10 bg-blue-500 text-white p-1.5 rounded-full border-2 border-white" title="${window.t ? window.t('hero-subtitle').split('•')[1].trim() : 'Vérifié'}">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            </div>` : ''}
                        </div>
                        
                        <div class="inline-flex items-center gap-1.5 ${statusClass} px-2.5 py-0.5 rounded-full text-[10px] font-bold tracking-wide mb-3">
                            <i data-lucide="${statusIcon}" class="w-3 h-3"></i> ${statusText.toUpperCase()}
                        </div>

                        <h3 class="text-lg font-bold text-primary mb-1">
                            <a href="artisan-profile.html?id=${m.id}" class="hover:text-accent transition-colors">${displayName}</a>
                        </h3>
                        <p class="text-sm text-gray-500 font-medium mb-4">${displayTrade} • ${m.city}</p>

                        <div class="flex items-center justify-center gap-4 w-full mb-6 text-sm">
                            <div class="flex flex-col">
                                <span class="font-bold text-primary">${m.rating}</span>
                                <div class="flex text-yellow-400 text-xs">
                                    <i data-lucide="star" class="w-3 h-3 fill-current"></i>
                                    <i data-lucide="star" class="w-3 h-3 fill-current"></i>
                                    <i data-lucide="star" class="w-3 h-3 fill-current"></i>
                                    <i data-lucide="star" class="w-3 h-3 fill-current"></i>
                                    <i data-lucide="star-half" class="w-3 h-3 fill-current"></i>
                                </div>
                            </div>
                            <div class="w-px h-8 bg-gray-100"></div>
                            <div class="flex flex-col">
                                <span class="font-bold text-primary">${m.interventions_count}</span>
                                <span class="text-xs text-gray-400">Missions</span>
                            </div>
                            <div class="w-px h-8 bg-gray-100"></div>
                            <div class="flex flex-col">
                                <span class="font-bold text-primary">Validé</span> 
                                <span class="text-xs text-gray-400">${m.certification_date ? new Date(m.certification_date).getFullYear() : 'N/A'}</span>
                            </div>
                        </div>

                        <div class="flex gap-2 w-full mt-auto">
                            <a href="artisan-profile.html?id=${m.id}" class="flex-1 bg-white border-2 border-gray-100 text-gray-600 py-2.5 rounded-xl font-bold text-sm hover:border-primary hover:text-primary transition-colors">
                                Profil
                            </a>
                            <a href="booking.html?artisan_id=${m.id}" class="flex-1 bg-primary text-white py-2.5 rounded-xl font-bold text-sm hover:bg-accent transition-colors flex items-center justify-center gap-2">
                                Réserver
                            </a>
                        </div>
                    `;
                    grid.appendChild(el);
                });
                lucide.createIcons();
            }
        }

        // Parse URL Params
        const urlParams = new URLSearchParams(window.location.search);
        const urlCategory = urlParams.get('category') || '';
        const urlUrgency = urlParams.get('urgency') === 'true';

        // Set Filter Values
        if (urlCategory) specialtyFilter.value = urlCategory.charAt(0).toUpperCase() + urlCategory.slice(1);

        // Init
        renderMaallems(cityFilter.value, specialtyFilter.value);

        // Show Urgency Banner if needed
        if (urlUrgency) {
            const urgencyBanner = document.createElement('div');
            urgencyBanner.className = 'bg-red-600 text-white text-center py-3 font-bold px-4 mb-6 rounded-xl animate-pulse';
            urgencyBanner.innerHTML = `
                <div class="flex items-center justify-center gap-2">
                    <i data-lucide="siren" class="w-5 h-5"></i>
                    MODE URGENCE ACTIVÉ : Affichage des artisans disponibles immédiatement
                </div>
            `;
            // Insert after Header (using grid parent logic or just prepend to section)
            grid.parentElement.insertBefore(urgencyBanner, grid);
        }

        // Events
        searchBtn.addEventListener('click', () => {
            renderMaallems(cityFilter.value, specialtyFilter.value);
        });

        // Re-render when language changes (listen to mutation or custom event)
        // Since i18n.js doesn't emit event yet, we can simple observe html lang
        const observer = new MutationObserver(() => {
            renderMaallems(cityFilter.value, specialtyFilter.value);
        });
        observer.observe(document.documentElement, { attributes: true, attributeFilter: ['lang'] });

        // Live filtering?
        cityFilter.addEventListener('change', () => renderMaallems(cityFilter.value, specialtyFilter.value));
        specialtyFilter.addEventListener('change', () => renderMaallems(cityFilter.value, specialtyFilter.value));

        // Mobile Menu
        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        menuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
            mobileMenu.classList.toggle('flex');
        });
    </script>
</body>

</html>